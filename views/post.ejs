<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <form action="/post" method="post" enctype="multipart/form-data">
<input type="text" placeholder="enter title" name="title">
<textarea placeholder="enter your problem!" name="description" ></textarea>
  <input type="hidden" name="location" id="location">
<input type="hidden" name="latitude" id="latitude">
<input type="hidden" name="longitude" id="longitude">
<br> <br>

 <!-- Manual input -->
  <div id="manualLocationBox">
    <label>Enter location manually (if you don‚Äôt want auto):</label>
    <input type="text"  id="manualLocation" name="manualLocation" placeholder="Enter location">
  </div>

  <!-- Button for auto location -->
  <button type="button" onclick="getLocation()">üìç Use My Location</button>

<input type="file" name="image" class="border p-2 rounded w-full">
<input type="submit" value="submit issue">
    </form>

 <script>
    async function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            // set hidden values
            document.getElementById("latitude").value = lat;
            document.getElementById("longitude").value = lon;

            try {
              const res = await fetch(`/reverse-geocode?lat=${lat}&lon=${lon}`);
              const data = await res.json();

              if (data && data.display_name) {
                // set in hidden location
                document.getElementById("location").value = data.display_name;
                // also update manual input box so user can see/edit
              document.getElementById("manualLocation").value = data.display_name;
              } else {
                document.getElementById("location").value = `${lat}, ${lon}`;
                document.getElementById("manualLocation").value = `${lat}, ${lon}`;
              }
            } catch (err) {
              console.error("Reverse geocoding failed", err);
              document.getElementById("location").value = `${lat}, ${lon}`;
              document.getElementById("manualLocation").value = `${lat}, ${lon}`;
            }
          },
          (err) => {
            alert("Location access denied. Please type manually.");
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      } else {
        alert("Geolocation not supported in this browser.");
      }
    }
  </script>
</body>
</html>